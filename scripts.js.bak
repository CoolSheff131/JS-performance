const node = document.getElementById('main__devices');

let selected = 'all';
const select = document.getElementById('section__select');

const tabs = document.getElementById('section__tabs');

const listIds = ['all', 'kitchen', 'hall', 'lights', 'cameras'];

function selectTabById(newId) {
  const index = listIds.indexOf(newId);
  const oldIndex = listIds.indexOf(selected);

  const newTab = tabs.children[index];
  const newPanel = node.children[index + 1];
  const oldTab = tabs.children[oldIndex];
  const oldPanel = node.children[oldIndex + 1];

  selected = newId;

  newTab.classList.add('section__tab_active');
  newTab.setAttribute('aria-selected', 'true');
  newTab.setAttribute('tabindex', '0');
  newTab.focus({
    preventScroll: true,
  });

  newPanel.classList.remove('section__panel_hidden');
  newPanel.setAttribute('aria-hidden', 'false');

  select.value = newId;

  oldTab.classList.remove('section__tab_active');
  oldTab.setAttribute('aria-selected', 'false');
  oldTab.removeAttribute('tabindex');

  oldPanel.classList.add('section__panel_hidden');
  oldPanel.setAttribute('aria-hidden', 'true');
}

select.addEventListener('input', () => {
  selectTabById(select.value);
});

tabs.addEventListener('click', (event) => {
  const newId = event.target.dataset.id;
  selectTabById(newId);
});

tabs.addEventListener('keydown', (event) => {
  if (event.ctrlKey || event.metaKey || event.shiftKey || event.altKey) {
    return;
  }

  let index = listIds.indexOf(selected);
  if (event.which === 37) {
    // left
    --index;
  } else if (event.which === 39) {
    // right
    ++index;
  } else if (event.which === 36) {
    // home
    index = 0;
  } else if (event.which === 35) {
    // end
    index = listIds.length - 1;
  } else {
    return;
  }

  if (index >= listIds.length) {
    index = 0;
  } else if (index < 0) {
    index = listIds.length - 1;
  }

  selectTabById(listIds[index]);
  event.preventDefault();
});

const headerMenu = document.getElementById('header__menu');
const menuText = document.getElementById('header__menu-text');
let expanded = false;
const links = document.getElementById('header__links');

headerMenu.addEventListener('click', () => {
  expanded = !expanded;
  headerMenu.setAttribute('aria-expanded', expanded ? 'true' : 'false');
  menuText.innerHTML = expanded ? 'Закрыть меню' : 'Открыть меню';
  links.classList.toggle('header__links_opened', expanded);
  links.classList.add('header__links-toggled');
});
